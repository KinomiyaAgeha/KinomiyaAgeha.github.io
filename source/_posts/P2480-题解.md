---
title: luogu2480 古代猪文 题解
urls: lg2480-solution
tags:
  - 数论
  - 组合数学
  - 中国剩余定理
categories: 题解
math: true
abbrlink: d5f18c0a
date: 2021-08-25 10:33:19
---

[link](https://www.luogu.com.cn/problem/P2480)

求
$$
 g^{\sum_{k \mid n}C_n^k} \bmod 9999911659
$$
显然的，那一长串的东西是质数。

设它为 $ p$ 好了。

<!-- more -->

则有 $ \gcd{(g,n)}=1$

由欧拉定理的推论
$$
a^b \equiv a^{b \, \bmod \, \varphi(p)} \quad ( \bmod p)
$$
其中 $a$ 与 $p$ 互质，且 $b$ 为任意整数。

可得
$$
g^{\sum_{k \mid n}{C_n^k}}  \equiv g^{\sum_{k \mid n}{C_n^k \, \bmod \, p-1}} \quad (\bmod \, p)
$$
所以本题就变成了求右边的那个东西。

$ p-1$ 显然不是个质数。

不难发现~~但很难算出~~
$$
p-1=2 \times 3 \times 4679 \times 35617
$$
可以用 $ O(\sqrt{n})$ 的时间枚举 $ n$ 的约数。

考虑到 $n,g \le 10^9$，我们用 $ lucas$ 定理求出 $ \sum_{k \mid n}{C_n^k}$，并记录它们对上述四个因子取模的结果，这样就得到了一个线性同余方程组。
$$
\begin{cases}
 x \equiv 2  \quad (\bmod a_1) \\
 x \equiv 3  \quad (\bmod a_2) \\
 x \equiv 4679  \quad (\bmod a_3) \\
 x \equiv 35617  \quad (\bmod a_4) \\
\end{cases}
$$
然后用中国剩余定理求出满足上述条件的最小的 $x$，用快速幂求 $g^x$ 即可。

注意代码细节。

```cpp 
#include<cstdio>
#include<iostream>
using namespace std;
#define R register
#define ll long long
const ll a[4]={2,3,4679,35617};
ll n, g, ans, p=999911658ll, b[4], fac[36000]={1};
ll fp(ll x,ll y) {
    R ll z=1;
    for(;y;x=x*x%p,y>>=1ll) if(y&1ll) z=z*x%p;
    return z;
}
void exgcd(ll a,ll b,ll& x,ll& y) {
    if(!b) { x=1, y=0; return ; }
    exgcd(b,a%b,y,x), y-=a/b*x;
}
ll inv(ll a,ll p) {
    ll x, y;
    exgcd(a,p,x,y);
    return (x%p+p)%p;
}
ll C(ll x,ll p) {
    ll z=1, y=n;
    for(;x;x/=p,y/=p) {
        ll a=x%p, b=y%p;
        z=z*fac[b]%p*inv(fac[a],p)%p*inv(b<a?0:fac[b-a],p)%p;
    }
    return z;
}
int main() {
    scanf("%lld%lld",&n,&g), g%=p+1;
    if(!g) { puts("0"); return 0; }
    for(int i=1;i<=a[3];++i) fac[i]=fac[i-1]*i%p;
    for(int i=1;i*i<=n;++i) if(n%i==0) {
        for(int j=0;j<4;++j) b[j]=(b[j]+C(i,a[j]))%a[j];
        if(i*i!=n) for(j=0;j<4;++j) b[j]=(b[j]+C(n/i,a[j]))%a[j];
    }
    for(int i=0;i<4;++i) {
        ll x, y;
        exgcd(p/a[i],a[i],x,y);
        ans=(ans+x*(p/a[i])%p*b[i])%p;
    }
    ans=(ans+p)%p, ++p;
    printf("%lld\n",fp(g,ans));
}
```
